<!DOCTYPE html>
<html>
  <head>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 500px;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 600px;
        width: 600px;
        margin: 50px;
        padding: 0;
      }
    </style>
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIX97LpSGWoozB3nKv8NrSXwMpdHVzIXs">
    </script>


  </head>
  <body>
    <div id="map"></div>
    
    <script>
    
      var x = document.getElementById("map");
      var map;



      function initMap(opps) {
        // debugger;

        console.log('get position');
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {

            console.log(position.coords.latitude);
            console.log(position.coords.longitude);

            var mapOptions = {
              zoom: 16,
              center: {lat: position.coords.latitude, lng: position.coords.longitude}
            };
            map = new google.maps.Map(document.getElementById('map'), mapOptions);
            var marker = new google.maps.Marker({
              position: {lat: position.coords.latitude, lng: position.coords.longitude}, 
              map: map,
              title: "You're here!"
            });
            for (var i = 0; i < opps.length; i++) {
              console.log(opps[i])
              var marker = new google.maps.Marker(
              {
                position: {lat: opps[i].lat, lng: opps[i].lng},
                map: map
              });

            }
          })
        }
        
        else { 
          x.innerHTML = "Geolocation is not supported by this browser.";
        }
      };

  

      // function getLocation() {
      //   console.log('get position');
      //   if (navigator.geolocation) {
      //     navigator.geolocation.getCurrentPosition(initMap);
      //   } else { 
      //     x.innerHTML = "Geolocation is not supported by this browser.";
      //   }
      //   console.log(position.coords.latitude);
      //   console.log(position.coords.longitude);

        // navigator.geolocation.getCurrentPosition(function(location) {
        //   console.log(location.coords.latitude);
        //   console.log(location.coords.longitude);
        //   console.log(location.coords.accuracy);
        // });
      

      function get_all_opps(){
        // debugger;
        $.get('/format-data', initMap);
      }
// debugger;
      // getLocation();
      get_all_opps();
    

    
  
 
    

    </script>
    <!-- <script type="text/javascript">
    function test_func(data) {
        console.log(data);
    }
    test_func({{ data|safe }})
    </script> -->

    <!-- {{ data }} -->
  </body>
</html>